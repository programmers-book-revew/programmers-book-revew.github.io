---
layout: post
title: 継続的デリバリー
categories: rank_4
tags: [プログラマ, devops]
---


<div class="book"><div class="book_image"><a href="http://www.amazon.co.jp/dp/4048707876"><img src="/images/continuous_delivery.jpg"></img></a></div><div class="book_info">David Farley等/アスキー・メディアワークス</div><div class="clear"></div></div>

良い本だった。実務でリリース業務に携わったことがなく、その知識がゼロに等しい自分には、このような本を読むことで一通りの考え方が分かるというのは大変ありがたい。特に、どうやるという方法論ではなく、なぜやるのかという考え方を教えてくれるので、知識がすぐ陳腐化せずに、また応用も効きやすい。

個人的にはテスト駆動の開発はソースを変更したときに伴うテスト変更が面倒ですぐにやめてしまい、一回もできていなかったのだけど、ここまで何度もその価値を書かれると(540ページ越え!)洗脳されてしまう。人間が失敗しやすい所は、自動化する。難しい所を最初から何度も行うことで、最初に失敗することで本番に失敗しないようにする。言われてみると確かにと納得することが多い。どこまでできるかは分からないが試してみたい。

以下、自分用メモ<!--more-->

> 基本的なプラクティス

> 1. ビルドが壊れているときにはチェックインするな
2. コミットする前に、常にローカルでコミットテストを実行せよあるいは代わりにCIサーバーにやってもらえ
3. 次の作業を始める前に、コミットテストが通るまで待て
4. ビルドが壊れているのに、家に帰ってはならない
5. 常に以前のリビジョンに戻す準備をしておくこと
6. リバートする前にタイムボックスを切って修正する
7. 失敗したテストをコメントアウトするな
8. 自分が変更してビルドが壊れたら、すべてに対して責任をとれ
9. テスト駆動開発
(p.107の3.5節からの小見出しから)

> 受け入れテストはビジネスの言葉(エリック・エヴァンスの言う「ユビキタス言語」)で表現されるべきだ。アプリケーションの技術的な言葉でではない。これはつまり、チームで開発に使っているのと同じプログラミング言語で受け入れテストを書くのは構わないが、その抽象概念はビジネスのふるまいのレベルで動くべきなのだ。「注文する」のであって「ボタンを押下する」のではない。あるいは、「送金を確認する」のであって「資金テーブルに結果が入っているかを確認する」のではない。(p.173)

> リリース候補が本番にデプロイできるようになるころには、次に挙げるような内容が真実であると確実に言えるようになっている。

> * コードがコンパイルできる
* コードは開発者の期待通りに動く。なぜなら、ユニットテストを通っているからだ。
* システムはアナリストやユーザーの期待通りに動く。なぜなら、受け入れテストをすべて通っているからだ。
* 基板やベースラインとなる環境の設定が適切に管理されている。なぜなら、アプリケーションが本番と同じようにテストされているからだ。
* コードには適切なコンポーネントがすべてそろっている。なぜなら、デプロイできるからだ。
* デプロイメントシステムは正常に動く。なぜなら、リリース候補がこのステージに進んでくるまでに、一回は開発環境で、一回は受け入れテストステージで、一回はテスト環境で使われることになるからだ。
* バージョン管理システムには、デプロイメントに必要なものがすべて格納されていて、手作業の操作は必要ない。なぜなら、システムをすでに何度かデプロイしているからだ。
この「成功を積み重ねる」アプローチは、「プロセスをできるだけ早く失敗させる」という我々の規範と組み合わされて、あらゆるレベルで機能しているのだ。(p.180) 継続的リリースの長所

> 何もないところから完全なパイプラインを作成するための戦略を紹介する。たいていの場合、このようなステップを踏むことになる。

> 1. バリューストリームをモデル化して、動くスケルトンを作成する。
2. ビルドとデプロイプロセスを自動化する。
3. ユニットテストとコード解析を自動化する。
4. 受け入れテストを自動化する。
5. リリースを自動化する。
(p.180)デプロイメントパイプラインの実装

> 一般論として、アジャイルな開発では技術的負債を最小に抑えなければならない。そのためには、変更のたびにリファクタリングして設計を最適化することになる。しかし現実的には、トレードオフが存在する。ときには将来からの借入れのほうが有利なこともある。重要なのは、余裕を持って返済できるようにしておくことだ。(p.393) 研究開発についてもこの場合が当てはまる気がする。不確定要素が大きいときはそれを取り除くことに没頭すべきだから。
