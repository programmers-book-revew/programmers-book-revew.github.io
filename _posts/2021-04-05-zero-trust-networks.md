---
layout: post
title: ゼロトラストネットワーク
categories: rank_3
tags: [ネットワーク, oreilly]
---

<div class="book"><div class="book_image"><a href="https://www.oreilly.co.jp/books/9784873118888/"><img src="/images/zero-trust-networks.jpg"></a></div><div class="book_info">Evan Gilman等/O'Reilly Japan</div><div class="clear"></div></div>

### 自分のまとめ

記事程度しか読んでおらず単語くらいしか理解してない自分には良い本。といっても分かったようで分かってない所が多い。ただ、安易に「ゼロトラストでやりましょう」とか言ってはいけないレベルのもの(実現が困難)ということは分かった(googleが作るのに4年間かかっているし、その移行の大変さもすごい)。全ての端末、ネットワークを信頼しないということは、こういうことかと、教えてくれたので、概念的なこと(目指している方向性)は分かったことにしたい(何となく分かったけど、「自分でやれ」と言われたら「出来ません」と胸を張って言うレベル)。

認証のUXが疎かだと形骸化するというのは良い学びだった(p.120のメモ参照)。

### 自分用メモ

<!--more-->

ゼロトラストネットワークには 5 つの基本的な原則がある。
*  ネットワークは常に安全ではないと見なされる。
* ネットワーク上には外部および内部の脅威が常に存在する。
* ネットワークを信用できると判断するには、ローカルネットワークでは不十分である。
*  デバイス、ユーザー、ネットワークフローは 1 つ残らず認証および認可される。
* ポリシーは動的であり、できるだけ多くの情報源に基づいて作成されなければならない。(p.2)

境界モデルとゼロトラストモデルは根本的に異なっている。境界モデルは、信頼さ れるリソースと信頼されないリソース(言い換えれば、ローカルネットワークとイン ターネット)の間に壁を築こうとする。これに対し、ゼロトラストモデルは基本的に 負けを認め、「悪人」はどこにでもいるという現実を受け入れる。壁を築いて攻撃か ら弱い人々を守るのではなく、すべての住民を検閲者に変える。(p.20)

ゼロトラストネットワークは、ユーザー / アプリケーション認証、デバイス認証、信用という 3 つの重要な要素で構成される。(p.20)

突き詰めれば、境界モデルの欠点は、全体的な保護に欠けていることにある。頑丈 な殻に覆われた脆弱な体のようなものである。私たちが本当に求めているのは骨と肉 が詰まった堅牢な体である。つまり、アイデンティティをチェックし、立ち聞きでき ないように話す方法を知っている体である。(p.22)

攻撃者をベースとした脅威モデリング手法に目を向けるとしたら、攻撃者を能力の 低いもの(最も危険度の低いもの)から順に分類できる。
1. スクリプトキディ 標的をあらかじめ定めず、よく知られている脆弱性をツールなどを使って悪 用する能力の低い攻撃者。
2. 標的型攻撃者 特定の標的に対して特別な攻撃を用意する攻撃者。スピアフィッシングや産 業スパイがこのカテゴリに分類される。
3. インサイダー脅威 ログイン情報を持つ、システムの一般ユーザー。通常は、請負業者や権限を 持たない従業員がこのカテゴリに分類される。
4. 信頼されたインサイダー 強い権限を得ているシステムの管理者。
5. 国家レベルのアクター 外国政府または自国政府の支援を受け、標的を攻撃するための潤沢な資金と 位置特定能力を持つとされる攻撃者。(p.30)

ゼロトラストネットワークが対処できる のは、「信頼されたインサイダー」とそれよりも低レベルの攻撃者である。ほとんど の組織は、それよりも高度な攻撃を受けない。こうした攻撃者に対して緩和対策を展 開すれば、セキュリティ侵害の大部分が防がれ、業界のセキュリティレベルが劇的に 改善されるだろう。(p.32)

パ ブリック PKI はインターネット全体によって信頼されるが、ゼロトラストネットワー クでの使用は推奨されない。  
...  
パブリック PKI にはマイナスに働く欠点がいくつかある。1 つ目はコストである。ゼロトラストネットワークでは多くの証明書が使用される ため、そうした公的な機関に関連する署名のコストが法外なものになることがある。 ローテーションポリシーを考えれば、なおさらである。  
...  
パブリック PKI のもう 1 つの重大な欠点は、公的な機関を「完全」に信頼するの が難しいことである。  
...  
ゼロトラスト認証で は、ロールやユーザー ID といったサイト固有のメタデータを証明書に格納することがたいてい望まれる。そのため、パブリック CA のポリシーと相容れないこともあり 得る。さらに、すべてのパブリック CA がプログラマブルなインターフェイスを提供 するわけではないため、自動化が難しくなる。(p.38)

ゼロトラストネットワークでは、ユーザーとアプリケーションの権限に対する従来 の考えにとどまらず、ネットワーク上のデバイスの権限も考慮される。付与される権 限のレベルは、ユーザーまたはアプリケーションと、使用されるデバイスの組み合わ せによって決まる。ゼロトラストネットワークでは、ユーザーの権限をリソースへの アクセスに使用されるデバイスに結び付けることで、クレデンシャルの紛失や不正使 用の影響を低減できる。(p.41)

ゼロトラストネットワークでは、ネットワークリソースへのアクセス(またはアク セス権限の付与)を求めるデータプレーンのデバイスがコントロールプレーンにリク エストを送信する。コントロールプレーンは、そうしたリクエストを受け取って処理 するコンポーネントで構成される(図 2-5)。これらのコンポーネントは、リクエス トする側のシステムに関するデータを調べて、そのアクションがどれくらい危険であ るかを決定する。また、関連するポリシーを調べることで、そのアクションに必要な 信用スコアを特定する。そして、リクエストされたアクセスを許可するようにデータ プレーンシステムに通知するか、データプレーンシステムの設定を変更する。

コントロールプレーンがデータプレーンの変更に影響を与えるメカニズムはきわめ て重要である。データプレーンシステムは攻撃者にとってネットワークへの侵入口に なることがよくあるため、コントロールプレーンとの間のインターフェイスを安全な 状態にしておかなければならない。そうすれば、そのインターフェイスを突破して ネットワークで横断的侵害を開始することは不可能になる。データプレーンシステム とコントロールプレーンシステムの間でやり取りされるリクエストは、受信する側の システムが信用できることを保証するために、非パブリック PKI システムを使って 暗号化・認証されなければならない。コントロールプレーンとデータプレーンの間の インターフェイスは、ユーザー空間とカーネル空間の間のインターフェイスのようなものにすべきである。これら 2 つのシステム間でのやり取りは、権限の昇格を阻止するために厳重に切り離される。(p.47)

ネットワークエージェントとは、ネットワークリクエストをするエンティティについてわかっているデータの組み合わせを表す用語であり、通常は、ユーザー、アプリケーション、デバイスをデータとして含んでいる。従来は、これらのエンティティが別々に権限を付与されていたが、ゼロトラストネットワークは、リクエストに参加するすべての要素の組み合わせとしてポリシーを定義するのが最善であるという認識に立っている。  
...  
ネットワークエージェントについては、ポリシーを評価するために必要に応じて形 成される一時的なエンティティとして考えるとよいだろう。エージェントの形成に使 用されるデータ ̶̶ ユーザーまたはデバイスの情報 ̶̶ は一般に永続ストレージ に格納され、エージェントを形成するために取り出される。このデータを取得する時 点でのデータの組み合わせをエージェントと呼ぶ。(p.52)

ゼロトラストネットワークでの認可の判断において、実際に認可されるのはエー ジェントである。デバイスとユーザーを別々に認可したくなるが、そのようなアプ ローチは推奨されない。認可されるエンティティはエージェントであるため、ポリ シーもエージェントに対して定義される。(p.54)

エージェントとの関連において認証と認可の違いを理解しておくことは重要であ る。エージェントはあくまでも認可コンポーネントであり、認証にはいっさい関与し ない。実際問題として、認証はエージェントが形成される前に実施され、通常はユー ザーとデバイスに対して別々に実施される。たとえば、デバイスは X.509 証明書を 使って認証できるが、ユーザーは従来の多要素認証を使って認証されるかもしれない。

認証が成功したら、ユーザーとデバイスの一意な識別子を使ってエージェントとそ の詳細を構成することができる。デバイスの種類やデバイスの所有者といった情報を 含むデバイスの一意な識別子として、デバイス固有の証明書が使用されることがあ る。同様に、社内での役割といったユーザー情報を設定するためのルックアップキー として、ユーザーの名前が使用されることもある。

一般に、認証はセッションごとに実施されるが、認可はリクエストごとに実施する のが最善である。このため、認証リクエストの結果はキャッシュしてもよいが、エー ジェントや認可リクエストの結果はキャッシュすべきではない。なぜなら、認可の判 断に使用されるエージェントの情報はさまざまな要因に基づいて目まぐるしく変化す ることが考えられ、認可の判断には最新のデータを使用するのが望ましいからだ。(p.55)

ゼロトラストの認可アーキテクチャは、4 つの主要なコンポーネントで構成される (図 4-1)。
* エンフォーサ
* ポリシーエンジン
* トラストエンジン
* データストア
...  
エンフォースメントコンポーネント(エンフォーサ)はシステム全体のあちこちに 存在することになる。このコンポーネントはワークロードのできるだけ近くに配置す べきである。認可の判断に直接影響をおよぼすのは、このコンポーネントである。一 般に、このコンポーネントはロードバランサ、プロキシ、あるいはファイアウォール として実装され、実際の判断を下すポリシーエンジンとやり取りする。エンフォーサ は、クライアントが認証されていることを確認し、各フローやリクエストのコンテキストをポリシーエンジンに渡す。ポリシーエンジンは、リクエストとそのコンテキス トをポリシーと比較し、そのリクエストが許可されるかどうかをエンフォーサに通知する。

ポリシーエンジンは、リスク分析にトラストエンジンを使用する。トラストエンジ ンは、信用スコア(クレジットスコアと同様)を計算するために複数のデータソース を使用する。信用スコアは未知の未知に対する防御に使用できるほか、ポリシーを(エッジケースやシグネチャで複雑にすることなく)強力かつ堅牢に保つのに役立つ。 ポリシーエンジンは、認可の判断に使用できる追加のコンポーネントとして信用スコ アを使用する。Google の BeyondCorp は、このテクノロジの草分けとして広く知ら れている。  最後のコンポーネントは、さまざまなデータストアである。これらのデータストア は、認可情報として使用されるデータの信頼できる情報源となる。このデータは特定 のリクエスト / フローの全体的なコンテキストを明らかにするために使用され、認 証されたエンティティの属性(ユーザー名、デバイスのシリアル番号など)がプライ マリルックアップキーとして使用される。これらのデータストアに含まれるデータ は、ユーザーデータかもしれないし、デバイスデータやその他のデータかもしれない。
(p.63)

突然の位置の変更は、そうしたケースの 1 つかもしれない。ここでのテーマはデ バイスの認証であるため、デバイスが移動する方法に関して合理的な期待値を設定で きる。たとえば、ほんの数時間前にアメリカのオフィスでデバイスに権限が付与され ているとしたら、同じデバイスがヨーロッパから認証を試みるのは、かなり不審なことに思える。

ゼロトラストモデルに関しては、このことがちょっとした危険をはらんでいることに注意すべきである。ゼロトラストの目標はネットワーク内から有利な立場をなくす ことである。そう考えると、ネットワークの位置に基づいてアクセス権限を決定す る、というのは少し矛盾しているように思える。

筆者はこのことを認め、位置情報が認可の判断材料になる可能性があることに同意 する。とはいえ、この判断が二元的ではないことが重要である。位置のパターンを探 るべきであり、位置だけに基づいて絶対的な判断を行ってはならない。たとえば、ア プリケーションにオフィスからしかアクセスできないことを定めるポリシーは、ゼロ トラストモデルに真っ向から違反している。(p.110)

ゼロトラストネットワークでは認証が義務付けられているが、工夫次第で、セキュリティを大幅に強化すると同時に、ユーザーの利便性を保つことができる。  認証では、「簡単であってはならない」、「安全でなければならない」というスタン スに(当然のごとく)陥りがちである。だが、ゼロトラストネットワークを設計する 上で、ユーザーの利便性は最も重要な要素の 1 つである。ユーザーエクスペリエン スが疎かなセキュリティは、当のユーザーによって組織的に弱体化され、ないがしろ にされることが多い。ユーザーは不便さを感じるとセキュリティにまじめに取り組む 気をなくしてしまい、むしろ抜け道を使うようになる。(p.120)


ゼロトラストネットワークは最初 から完全に満たさなければならない要件のリストではなく、それらの要件を目標とし て取り組んでいくべきものである。その点では、境界ベースのネットワークと何ら変 わらない。それほど成熟していないネットワークでは、システム管理の複雑さを低減 するために、最初は単純なネットワーク設計を選択するとよいかもしれない。ネット ワークの成熟度とセキュリティリスクが高まるに従い、システムの分離を進めるためにネットワークの再設計が必要になるだろう。(p.211)

ゼロトラストネットワークのスコープを絞り込むには、必然的に、本書にすでに登 場した一連の特性に優先順位を付ける必要がある。そこで、優先順位を付ける方法に関する筆者の見解をRFCスタイルの優先順位リストにまとめてみた。
* ネットワークフローはすべて処理される前に認証されなければならない (MUST)。
* ネットワークフローはすべて送信される前に暗号化されるべきである (SHOULD)。
* 認証と暗号化はネットワーク内のエンドポイントで実行されなければならない(MUST)。
* システムがアクセス制御を実行できるようにするために、ネットワークフ ローはすべて列挙されなければならない(MUST)。
* ネットワーク内では最も強力な認証 / 暗号化スイートを使用すべきである(SHOULD)。
* 認証にパブリック PKI プロバイダを使用すべきではなく(SHOULD NOT)、 代わりにプライベート PKI を使用すべきである。
* デバイスのスキャン、パッチ、ローテーションは定期的に実行すべきである(SHOULD)。(p.212)

**ネットワークフローはすべて処理される前に認証されなければならない(MUST)**  
...  
ネットワークデータの出所について確信を得るには、認証が必要不可欠である。認 証はおそらく、ゼロトラストネットワークの唯一無二の最重要コンポーネントである。認証ができなければ、ネットワークを信頼せざるを得なくなる。(p.214)

**ネットワークフローはすべて送信される前に暗号化されるべきである(SHOULD)**  
...  
ネットワークリンクによってデータや信号がシステム間で確 実に伝達される、という確証がないことである。不用意なアクターがネットワークリ ンクに物理的にアクセスできる場合、ネットワークの安全性はいとも簡単に失われて しまう。さらに、物理的に安全なネットワークでさえ、たちの悪いアクターが電子的 にシステムに侵入し、ネットワーク内で価値の高いデータを受動的に嗅ぎまわるおそれがある。(p.214)

**認証と暗号化はネットワーク内のエンドポイントで実行されなければならない(MUST)**  
...  
ネットワークリンクを無条件に信頼することは、システムのセキュリティにとって 脅威となる。ゼロトラストネットワークはこの脅威を認識しているため、アプリケー ション層のエンドポイント間でセキュアな通信が確立されることが重要となる。そう した責務を担うネットワーク上のミドルウェアコンポーネント(VPN コンセントレー タ、TLS ターミネーション対応のロードバランサなど)を追加すると、そうしたコ ンポーネントとエンドポイント間のネットワーク通信が物理的および仮想的な脅威にさらされたままになる可能性がある。(p.214)

**システムがアクセス制御を実行できるようにするために、ネットワークフローはすべて列挙されなければならない(MUST)**  
...  
ゼロトラストネットワークは、ネットワークの期待される挙動を定義するデータに 依存する。したがって、ネットワークを保護するには、期待されるネットワークフ ローを 1 つ残らず定義することが不可欠である。  
...
期待されるネットワークフローのリストがなければ、ゼロトラストシステムが想定 外の通信を検知してシステム管理者に注意を促したり、それらの通信を拒否したりす ることは不可能である。(p.215)

**ネットワーク内では最も強力な認証 / 暗号化スイートを使用すべきである(SHOULD)**  
ゼロトラストネットワークでは、ネットワーク環境が敵対的であると仮定する。こ のため、ゼロトラストネットワークのセキュリティにおいて、強力な認証 / 暗号化 スイートは重要な要素である。(p.216)

**認証にパブリック PKI プロバイダを使用すべきではなく(SHOULD NOT)、代わりにプライベート PKI を使用すべきである**  
...  
ゼロトラストネットワークではなぜプライベート PKI を優先するのだろうか。 その理由は、サードパーティを信頼するとシステムのリスクが高まることにある。ゼ ロトラストが信頼と信用管理に焦点を合わせていることを考えれば、それほど意外な 理由ではない。パブリック PKI はゼロトラストネットワークに次のようなリスクを もたらす。

リスクの 1 つは、「信頼される」と見なされるパブリック CA の数である。  
...  
パブリック CA の使用には別の脅威もある。国家レベルのアクターは、組織が顧客 に提供する信頼保証に反する振る舞いを強制するために、司法権をより積極的に行使 し始めている。(p.216)

**デバイスのスキャン、パッチ、ローテーションは定期的に実行すべきである(SHOULD)**  
...  
システム管理者は、ネットワーク上の信用されるデバ イスが侵入されることを前提に、この脅威を低減する防御をデバイス管理に組み込む 必要がある。(p.217)


非常に大規模なネットワークでは、すべてのネットワークフローをキャプチャ・ 分類するのは大変な作業になりかねない。必然的に、「すべてのネットワーク接続を キャプチャすることはゼロトラストネットワークへ移行するための要件なのか」とい う疑問が浮かぶ。幸いなことに、ゼロトラストネットワークは既存の境界ベースのシステム内で少しずつ実現できる。既存の境界ネットワークまたはネットワーク境界を うまく利用すれば、境界のどちら側でもゼロトラストネットワークを構築できる。ゼ ロトラストモデルをゾーンからゾーンへと広げていけば(図 9-3)、すでに導入され ている運用上のセキュリティ対策を維持した上で、既存のシステムのネットワークセ キュリティを強化できる。(p.221)

単純な解決策は、アプリケーションごとにユーザー名とパスワードを格納すること である。ただし、この手法はまったく推奨されない。その理由は、管理の複雑さにあ る。  アプリケーションごとに認証システムを実装するよりも、それらのアプリケーショ ンをアイデンティティプロバイダシステムと統合し、認証と認可を一元的に提供で きるようにするほうがずっと効果的である。SAML(Security Assertion Markup Language)は、アプリケーションをアイデンティティプロバイダに統合するための 技術標準である。(p.224)

**TOTPよりもセキュリティトークン**  
多要素認証が組織に最初に導入された当時は、時間に基づくトークンを絶えず生成する 単純なデバイスがユーザーに配布されていた。最近のスマートフォンの普及率を考える と、ほとんどのユーザーはスマートフォン上の多要素アプリケーションを使ってコード を生成したいと考えるだろう。

ハードウェアを使用する FIDO2 などのプロトコルは、フィッシング攻撃に対する防御 力により、時間ベースのトークンシステムよりも好まれるケースが増えている。しか も、そうしたシステムのほうが一般にユーザーにとって操作しやすい。可能であれば、 TOTP システムよりもセキュリティトークンを優先しよう。(p.225)

ゼロトラストモデルでは、コントロールプレーンを提唱している。コントロールプ レーンは、認可の結果をネットワークに反映させることで、信用される通信を実現 する。このモデルでは、ネットワークフローの認証と認可が個別に行われる。エン フォースメントは、認可された通信を許可するようにネットワークファブリックを変 更する、あるいはネットワークファブリックに通知することによって実現される。  このようなコントロールプレーンシステムを持たない簡易的なゼロトラストネット ワークでは、計画を縮小せざるを得ない。つまり、動的な注入や通知を用いるネット ワークを構築する代わりに、リレーショナルなポリシーを定義するシステムを構築す ることになるだろう。

そうしたポリシーでは、2 つのデバイス間の通信がファイアウォールといった従来 のネットワークフィルタリングメカニズムを使って定義および制御され、TLS 接続 が必要となる。こうしたポリシーエンフォースメントメカニズムは、境界ベースのモ デルとよく似ているように思えるかもしれない。境界ベースのモデルとの大きな違い は、リレーショナルなモデルでは、ポリシーのスコープが(通信しているネットワー クセグメントではなく)通信しているデバイスに限定されることである。この手法は マクロ境界化(microperimeterization)とも呼ばれる。(p.226)

Google の従業員や社内ネットワークの範囲と規模、そして従業員が(クラウド サービスやさまざまなクライアントデバイスを使用するモバイルワークフォースとし て)エンタープライズリソースとやり取りする方法の多様さを考えると、城壁では力 不足であることは明らかだった。中世の城よりも近代都市にはるかに近い戦略が必要 だった。つまり、どのネットワークを使用するのかではなく、誰が使用するのかに照 らして、アプリケーション、データ、サービスへのアクセスを仲介するシステムが求められていた。(p.233)

社内ネットワークセキュリティの新たな構想作りに着手した Google は、堅牢な ゼロトラストモデルを実装するための設計とイテレーションに 4 年以上を費やした。

ほとんどの企業では、社内ネットワークは社内アプリケーションを公開するのに安全な環境と想定されるが、Google では、社内ネットワークはインターネットと同様に 危険な環境と想定される。

この新しいモデルでは、特権的な社内ネットワークが完全に排除され、ユーザーが ネットワークにどこからアクセスするかに関係なく、デバイスとユーザーのクレデン シャルだけに基づいてアクセスが決定される。ユーザーは、社内からでも、自宅から でも、ホテルやコーヒーショップからでも、各自のクレデンシャルに基づいてネット ワークにアクセスできる。エンタープライズリソースへのアクセスはすべて、デバイスの状態とユーザーのクレデンシャルに基づいて完全に認証・認可され、完全に暗号 化される。エンタープライズリソースのさまざまな部分に対するアクセスは細かく制 御できる。結果として、Google の従業員全員がどのネットワークからでも問題なく 作業を行うことができ、特権的ネットワークへの従来の VPN 接続はいらなくなる。 エンタープライズリソースへのローカルアクセスでもリモートアクセスでもユーザー エクスペリエンスは実質的に同じであり、遅延に差が生じるかもしれない、という程 度の違いしかない。(p.233)


BeyondCorp には、「マネージドデバイス」という概念がある。マネージドデバイ スとは、企業によって調達され、管理されるデバイスのことである。社内アプリケー ションにアクセスできるのはマネージドデバイスだけである。  
...  
マネージドデバイスはすべて、デバイスインベントリのレコードとの照合により、 一意に識別されなければならない。この一意な識別を実現する方法の 1 つは、デバ イスごとに作成されるデバイス証明書を使用することである。
...  
証明書はデバイスを一意に識別するが、証明書だけでアクセス権限が付与される わけではなく、デバイスに関する情報に対する鍵として使用される。(p.235)


